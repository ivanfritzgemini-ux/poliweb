{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ivanf/Desktop/poli/src/app/login/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport React, { useState } from 'react'\r\nimport { useRouter } from 'next/navigation'\r\nimport { supabase } from '@/lib/supabase'\r\nimport { Input } from '@/components/ui/input'\r\nimport { Button } from '@/components/ui/button'\r\nimport { useToast } from '@/hooks/use-toast'\r\n\r\nexport default function LoginPage() {\r\n  const router = useRouter()\r\n  const { toast } = useToast()\r\n\r\n  const [email, setEmail] = useState('')\r\n  const [password, setPassword] = useState('')\r\n  const [loading, setLoading] = useState(false)\r\n\r\n  async function handleSubmit(e: React.FormEvent) {\r\n    e.preventDefault()\r\n    setLoading(true)\r\n\r\n    try {\r\n      const { data, error } = await supabase.auth.signInWithPassword({\r\n        email,\r\n        password,\r\n      })\r\n\r\n      if (error) {\r\n        toast({ title: 'Error', description: error.message })\r\n        setLoading(false)\r\n        return\r\n      }\r\n\r\n      const userId = data.session?.user?.id\r\n\r\n      if (!userId) {\r\n        toast({ title: 'Error', description: 'No se pudo obtener el usuario.' })\r\n        setLoading(false)\r\n        return\r\n      }\r\n\r\n      // Fetch profile from usuarios table including role (roles.nombre_rol)\r\n      const { data: profile, error: profileError } = await supabase\r\n        .from('usuarios')\r\n        .select('id, nombres, apellidos, email, role:roles(id, nombre_rol)')\r\n        .eq('id', userId)\r\n        .single()\r\n\r\n      if (profileError) {\r\n        // If user is authenticated but has no profile row, inform the user\r\n        toast({ title: 'Perfil no encontrado', description: profileError.message || 'No hay perfil para este usuario.' })\r\n        setLoading(false)\r\n        return\r\n      }\r\n\r\n      // Save a minimal profile in localStorage for client usage\r\n      try {\r\n        localStorage.setItem('userProfile', JSON.stringify(profile))\r\n      } catch (err) {\r\n        // ignore localStorage errors\r\n      }\r\n\r\n  toast({ title: 'Bienvenido', description: `Hola ${profile.nombres} ${profile.apellidos}` })\r\n\r\n  // Redirect to root dashboard page /\r\n  router.push('/')\r\n    } catch (err: any) {\r\n      toast({ title: 'Error', description: err?.message || String(err) })\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-surface\">\r\n      <div className=\"w-full max-w-md p-8 rounded-lg shadow-sm bg-card\">\r\n        <h1 className=\"text-2xl font-semibold mb-6\">Iniciar sesión</h1>\r\n\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium mb-1\">Email</label>\r\n            <Input\r\n              type=\"email\"\r\n              value={email}\r\n              onChange={(e) => setEmail(e.target.value)}\r\n              placeholder=\"correo@ejemplo.com\"\r\n              required\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium mb-1\">Contraseña</label>\r\n            <Input\r\n              type=\"password\"\r\n              value={password}\r\n              onChange={(e) => setPassword(e.target.value)}\r\n              placeholder=\"••••••••\"\r\n              required\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex justify-end\">\r\n            <Button type=\"submit\" disabled={loading}>\r\n              {loading ? 'Ingresando...' : 'Ingresar'}\r\n            </Button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AAPA;;;;;;;;AASe,SAAS;IACtB,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,EAAE,KAAK,EAAE,GAAG,IAAA,wIAAQ;IAE1B,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;IACnC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAC;IACzC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,eAAe,aAAa,CAAkB;QAC5C,EAAE,cAAc;QAChB,WAAW;QAEX,IAAI;YACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,kIAAQ,CAAC,IAAI,CAAC,kBAAkB,CAAC;gBAC7D;gBACA;YACF;YAEA,IAAI,OAAO;gBACT,MAAM;oBAAE,OAAO;oBAAS,aAAa,MAAM,OAAO;gBAAC;gBACnD,WAAW;gBACX;YACF;YAEA,MAAM,SAAS,KAAK,OAAO,EAAE,MAAM;YAEnC,IAAI,CAAC,QAAQ;gBACX,MAAM;oBAAE,OAAO;oBAAS,aAAa;gBAAiC;gBACtE,WAAW;gBACX;YACF;YAEA,sEAAsE;YACtE,MAAM,EAAE,MAAM,OAAO,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,kIAAQ,CAC1D,IAAI,CAAC,YACL,MAAM,CAAC,6DACP,EAAE,CAAC,MAAM,QACT,MAAM;YAET,IAAI,cAAc;gBAChB,mEAAmE;gBACnE,MAAM;oBAAE,OAAO;oBAAwB,aAAa,aAAa,OAAO,IAAI;gBAAmC;gBAC/G,WAAW;gBACX;YACF;YAEA,0DAA0D;YAC1D,IAAI;gBACF,aAAa,OAAO,CAAC,eAAe,KAAK,SAAS,CAAC;YACrD,EAAE,OAAO,KAAK;YACZ,6BAA6B;YAC/B;YAEJ,MAAM;gBAAE,OAAO;gBAAc,aAAa,CAAC,KAAK,EAAE,QAAQ,OAAO,CAAC,CAAC,EAAE,QAAQ,SAAS,EAAE;YAAC;YAEzF,oCAAoC;YACpC,OAAO,IAAI,CAAC;QACV,EAAE,OAAO,KAAU;YACjB,MAAM;gBAAE,OAAO;gBAAS,aAAa,KAAK,WAAW,OAAO;YAAK;QACnE,SAAU;YACR,WAAW;QACb;IACF;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAG,WAAU;8BAA8B;;;;;;8BAE5C,8OAAC;oBAAK,UAAU;oBAAc,WAAU;;sCACtC,8OAAC;;8CACC,8OAAC;oCAAM,WAAU;8CAAiC;;;;;;8CAClD,8OAAC,0IAAK;oCACJ,MAAK;oCACL,OAAO;oCACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;oCACxC,aAAY;oCACZ,QAAQ;;;;;;;;;;;;sCAIZ,8OAAC;;8CACC,8OAAC;oCAAM,WAAU;8CAAiC;;;;;;8CAClD,8OAAC,0IAAK;oCACJ,MAAK;oCACL,OAAO;oCACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;oCAC3C,aAAY;oCACZ,QAAQ;;;;;;;;;;;;sCAIZ,8OAAC;4BAAI,WAAU;sCACb,cAAA,8OAAC,4IAAM;gCAAC,MAAK;gCAAS,UAAU;0CAC7B,UAAU,kBAAkB;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAO3C","debugId":null}}]
}