(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[991],{4523:(e,s,l)=>{"use strict";l.d(s,{StaffList:()=>M});var n=l(7394),r=l(1658),a=l(8372),t=l(7656),c=l(7124),i=l(6952),o=l(1907),d=l(8295);let m=(0,o.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function x(e){let{className:s,variant:l,...r}=e;return(0,n.jsx)("div",{className:(0,d.cn)(m({variant:l}),s),...r})}var h=l(2002);let j=(0,h.A)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),u=(0,h.A)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);var p=l(7631),f=l(7206),N=l(2182),b=l(5414),v=l(2823),g=l(4942),w=l(9152),C=l(3364),y=l(925);let _=(0,y.createServerReference)("7014aeacba3bd42398f3967c7b2fa6de14213b93c5",y.callServer,void 0,y.findSourceMapURL,"updateStaff"),S=(0,y.createServerReference)("40d8c6ec2c7b2e905ea36f56b8778a090c8bf6bab7",y.callServer,void 0,y.findSourceMapURL,"addStaff");var z=l(5071);let A=v.z.object({rut:v.z.string().refine(d.y,{message:"RUT inv\xe1lido."}),nombres:v.z.string().min(2,"Los nombres deben tener al menos 2 caracteres."),apellidos:v.z.string().min(2,"Los apellidos deben tener al menos 2 caracteres."),sexo_id:v.z.string({required_error:"Debe seleccionar un sexo."}),email:v.z.string().email("Email inv\xe1lido."),password:v.z.string().min(6,"La contrase\xf1a debe tener al menos 6 caracteres.").optional(),rol_id:v.z.string({required_error:"Debe seleccionar un rol."}),fecha_nacimiento:v.z.string({required_error:"Debe seleccionar una fecha de nacimiento."}).refine(e=>!isNaN(new Date(e).getTime()),{message:"La fecha de nacimiento no es v\xe1lida."}),telefono:v.z.string().optional(),direccion:v.z.string().optional()});function k(e){var s,l;let{staff:a,onSuccess:i,sexos:o,roles:d}=e,{toast:m}=(0,C.dj)(),[x,h]=(0,r.useState)(!1),j=(0,N.mN)({resolver:(0,b.u)(A),defaultValues:a?{rut:a.rut,nombres:a.nombres,apellidos:a.apellidos,sexo_id:(null==(s=a.sexo)?void 0:s.id)||"",email:a.email,rol_id:(null==(l=a.role)?void 0:l.id)||"",fecha_nacimiento:a.fecha_nacimiento?a.fecha_nacimiento.substring(0,10):"",telefono:a.telefono||"",direccion:a.direccion||""}:{rut:"",nombres:"",apellidos:"",sexo_id:"",password:"",email:"",rol_id:"",fecha_nacimiento:"",telefono:"",direccion:""}});async function u(e){h(!0);try{let s,l=new Date(e.fecha_nacimiento),n={nombres:e.nombres,apellidos:e.apellidos,sexo_id:e.sexo_id,rol_id:e.rol_id,fecha_nacimiento:l.toISOString(),telefono:e.telefono||null,direccion:e.direccion||null};a?(await _(a.rut,n,a.id),s={...a,...n,sexo:o.find(s=>s.id===e.sexo_id)||null,role:d.find(s=>s.id===e.rol_id)||null},m({title:"Personal Actualizado",description:"".concat(e.nombres," ").concat(e.apellidos," ha sido actualizado.")})):(s=await S({...n,rut:e.rut,email:e.email,password:e.password}),m({title:"Personal A\xf1adido",description:"".concat(e.nombres," ").concat(e.apellidos," ha sido a\xf1adido al sistema.")})),i(s),j.reset()}catch(e){m({title:"Error",description:e.message||"Ocurri\xf3 un error desconocido.",variant:"destructive"})}finally{h(!1)}}return(0,n.jsx)(g.lV,{...j,children:(0,n.jsxs)("form",{onSubmit:j.handleSubmit(u),className:"grid grid-cols-2 gap-x-8 gap-y-4 pt-4",children:[(0,n.jsx)(g.zB,{control:j.control,name:"rut",render:e=>{let{field:s}=e;return(0,n.jsxs)(g.eI,{children:[(0,n.jsx)(g.lR,{className:"text-xs sm:text-sm",children:"RUT"}),(0,n.jsx)(g.MJ,{children:(0,n.jsx)(c.p,{...s,disabled:!!a})}),(0,n.jsx)(g.C5,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)(g.zB,{control:j.control,name:"email",render:e=>{let{field:s}=e;return(0,n.jsxs)(g.eI,{children:[(0,n.jsx)(g.lR,{className:"text-xs sm:text-sm",children:"Email"}),(0,n.jsx)(g.MJ,{children:(0,n.jsx)(c.p,{...s,disabled:!!a})}),(0,n.jsx)(g.C5,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)(g.zB,{control:j.control,name:"nombres",render:e=>{let{field:s}=e;return(0,n.jsxs)(g.eI,{children:[(0,n.jsx)(g.lR,{className:"text-xs sm:text-sm",children:"Nombres*"}),(0,n.jsx)(g.MJ,{children:(0,n.jsx)(c.p,{placeholder:"Ej: Ricardo",...s})}),(0,n.jsx)(g.C5,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)(g.zB,{control:j.control,name:"apellidos",render:e=>{let{field:s}=e;return(0,n.jsxs)(g.eI,{children:[(0,n.jsx)(g.lR,{className:"text-xs sm:text-sm",children:"Apellidos*"}),(0,n.jsx)(g.MJ,{children:(0,n.jsx)(c.p,{placeholder:"Ej: P\xe9rez D\xedaz",...s})}),(0,n.jsx)(g.C5,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)(g.zB,{control:j.control,name:"sexo_id",render:e=>{let{field:s}=e;return(0,n.jsxs)(g.eI,{children:[(0,n.jsx)(g.lR,{className:"text-xs sm:text-sm",children:"Sexo*"}),(0,n.jsxs)(w.l6,{onValueChange:s.onChange,value:s.value,children:[(0,n.jsx)(g.MJ,{children:(0,n.jsx)(w.bq,{children:(0,n.jsx)(w.yv,{placeholder:"Seleccione el sexo"})})}),(0,n.jsx)(w.gC,{children:o.map(e=>(0,n.jsx)(w.eb,{value:e.id,children:e.nombre},e.id))})]}),(0,n.jsx)(g.C5,{className:"text-xs sm:text-sm"})]})}}),!a&&(0,n.jsx)(g.zB,{control:j.control,name:"password",render:e=>{let{field:s}=e;return(0,n.jsxs)(g.eI,{children:[(0,n.jsx)(g.lR,{className:"text-xs sm:text-sm",children:"Contrase\xf1a*"}),(0,n.jsx)(g.MJ,{children:(0,n.jsx)(c.p,{type:"password",placeholder:"********",...s})}),(0,n.jsx)(g.C5,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)(g.zB,{control:j.control,name:"rol_id",render:e=>{let{field:s}=e;return(0,n.jsxs)(g.eI,{children:[(0,n.jsx)(g.lR,{className:"text-xs sm:text-sm",children:"Rol*"}),(0,n.jsxs)(w.l6,{onValueChange:s.onChange,value:s.value,children:[(0,n.jsx)(g.MJ,{children:(0,n.jsx)(w.bq,{children:(0,n.jsx)(w.yv,{placeholder:"Seleccione un rol"})})}),(0,n.jsx)(w.gC,{children:d.map(e=>(0,n.jsx)(w.eb,{value:e.id,children:e.nombre_rol},e.id))})]}),(0,n.jsx)(g.C5,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)(g.zB,{control:j.control,name:"fecha_nacimiento",render:e=>{let{field:s}=e;return(0,n.jsxs)(g.eI,{className:"col-span-2",children:[(0,n.jsx)(g.lR,{className:"text-xs sm:text-sm",children:"Fecha de Nacimiento*"}),(0,n.jsx)(g.MJ,{children:(0,n.jsx)(c.p,{type:"date",placeholder:"YYYY-MM-DD",...s,value:s.value?s.value.substring(0,10):""})}),(0,n.jsx)(g.C5,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)(g.zB,{control:j.control,name:"telefono",render:e=>{let{field:s}=e;return(0,n.jsxs)(g.eI,{children:[(0,n.jsx)(g.lR,{className:"text-xs sm:text-sm",children:"Tel\xe9fono"}),(0,n.jsx)(g.MJ,{children:(0,n.jsx)(c.p,{placeholder:"Ej: +56912345678",...s})}),(0,n.jsx)(g.C5,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)(g.zB,{control:j.control,name:"direccion",render:e=>{let{field:s}=e;return(0,n.jsxs)(g.eI,{children:[(0,n.jsx)(g.lR,{className:"text-xs sm:text-sm",children:"Direcci\xf3n"}),(0,n.jsx)(g.MJ,{children:(0,n.jsx)(c.p,{placeholder:"Ej: Calle Falsa 123",...s})}),(0,n.jsx)(g.C5,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)("div",{className:"col-span-2 flex justify-end pt-2",children:(0,n.jsxs)(t.$,{type:"submit",disabled:x,children:[x&&(0,n.jsx)(z.A,{className:"mr-2 h-4 w-4 animate-spin"}),a?"Actualizar":"A\xf1adir"]})})]})})}var E=l(8458),R=l(209);function M(e){let{initialStaff:s,initialSexos:l,initialRoles:o}=e,[m,h]=(0,r.useState)(s),[N,b]=(0,r.useState)(l),[v,g]=(0,r.useState)(o),[w,y]=(0,r.useState)(!1),[_,S]=(0,r.useState)(""),[z,A]=(0,r.useState)(!1),[M,I]=(0,r.useState)(!1),[B,L]=(0,r.useState)(null),[D,J]=(0,r.useState)({key:null,direction:"ascending"}),{toast:P}=(0,C.dj)(),q=(0,r.useMemo)(()=>m.filter(e=>"".concat(e.nombres," ").concat(e.apellidos).toLowerCase().includes(_.toLowerCase())||e.email.toLowerCase().includes(_.toLowerCase())),[m,_]),$=(0,r.useMemo)(()=>{let e=[...q];return null!==D.key&&e.sort((e,s)=>{let l,n;if("nombreCompleto"===D.key)l="".concat(e.nombres," ").concat(e.apellidos),n="".concat(s.nombres," ").concat(s.apellidos);else if("rol"===D.key){var r,a;l=(null==(r=e.role)?void 0:r.nombre_rol)||"",n=(null==(a=s.role)?void 0:a.nombre_rol)||""}else l=e[D.key],n=s[D.key];return l<n?"ascending"===D.direction?-1:1:l>n?"ascending"===D.direction?1:-1:0}),e},[q,D]),O=e=>{let s="descending";D.key===e&&"descending"===D.direction&&(s="ascending"),J({key:e,direction:s})},U=e=>D.key!==e?null:"ascending"===D.direction?(0,n.jsx)(j,{className:"ml-2 h-4 w-4"}):(0,n.jsx)(u,{className:"ml-2 h-4 w-4"});return(0,n.jsxs)(i.lG,{open:z,onOpenChange:A,children:[(0,n.jsx)(E.Zp,{children:(0,n.jsxs)(E.Wu,{className:"p-2 sm:p-4",children:[(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 mb-4",children:[(0,n.jsxs)("div",{className:"relative w-full max-w-sm",children:[(0,n.jsx)(p.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,n.jsx)(c.p,{placeholder:"Buscar...",value:_,onChange:e=>S(e.target.value),className:"pl-10"})]}),(0,n.jsx)(i.zM,{asChild:!0,children:(0,n.jsxs)(t.$,{className:"w-full sm:w-auto",children:[(0,n.jsx)(f.A,{className:"mr-0 h-4 w-4 md:mr-2"}),(0,n.jsx)("span",{className:"hidden md:inline",children:"A\xf1adir Personal"})]})})]}),(0,n.jsx)("div",{className:"rounded-lg border",children:0!==m.length||w?w?(0,n.jsx)(()=>(0,n.jsxs)(a.XI,{children:[(0,n.jsx)(a.A0,{children:(0,n.jsxs)(a.Hj,{children:[(0,n.jsx)(a.nd,{className:"p-2 sm:p-4",children:(0,n.jsx)(R.E,{className:"h-6 w-20"})}),(0,n.jsx)(a.nd,{className:"p-2 sm:p-4",children:(0,n.jsx)(R.E,{className:"h-6 w-32"})}),(0,n.jsx)(a.nd,{className:"hidden sm:table-cell p-2 sm:p-4",children:(0,n.jsx)(R.E,{className:"h-6 w-16"})}),(0,n.jsx)(a.nd,{className:"hidden md:table-cell p-2 sm:p-4",children:(0,n.jsx)(R.E,{className:"h-6 w-40"})}),(0,n.jsx)(a.nd,{className:"p-2 sm:p-4",children:(0,n.jsx)(R.E,{className:"h-6 w-20"})}),(0,n.jsx)(a.nd,{className:"p-2 sm:p-4",children:(0,n.jsx)(R.E,{className:"h-6 w-20"})}),(0,n.jsx)(a.nd,{className:"text-right p-2 sm:p-4",children:"Acciones"})]})}),(0,n.jsx)(a.BF,{children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,n.jsx)(a.Hj,{className:"text-xs sm:text-sm",children:(0,n.jsx)(a.nA,{colSpan:7,children:(0,n.jsx)(R.E,{className:"h-8 w-full"})})},s))})]}),{}):(0,n.jsxs)(a.XI,{children:[(0,n.jsx)(a.A0,{children:(0,n.jsxs)(a.Hj,{children:[(0,n.jsx)(a.nd,{className:"p-2 sm:p-4",children:(0,n.jsxs)(t.$,{variant:"ghost",onClick:()=>O("rut"),children:["RUT ",U("rut")]})}),(0,n.jsx)(a.nd,{className:"p-2 sm:p-4",children:(0,n.jsxs)(t.$,{variant:"ghost",onClick:()=>O("nombreCompleto"),children:["Nombre ",U("nombreCompleto")]})}),(0,n.jsx)(a.nd,{className:"hidden sm:table-cell p-2 sm:p-4",children:"Sexo"}),(0,n.jsx)(a.nd,{className:"hidden md:table-cell p-2 sm:p-4",children:"Email"}),(0,n.jsx)(a.nd,{className:"p-2 sm:p-4",children:(0,n.jsxs)(t.$,{variant:"ghost",onClick:()=>O("rol"),children:["Rol ",U("rol")]})}),(0,n.jsx)(a.nd,{className:"p-2 sm:p-4",children:(0,n.jsxs)(t.$,{variant:"ghost",onClick:()=>O("status"),children:["Estado ",U("status")]})}),(0,n.jsx)(a.nd,{className:"text-right p-2 sm:p-4",children:"Acciones"})]})}),(0,n.jsx)(a.BF,{children:$.length>0?$.map(e=>{var s,l;return(0,n.jsxs)(a.Hj,{className:"text-xs sm:text-sm",children:[(0,n.jsx)(a.nA,{className:"font-medium p-2 sm:p-4",children:(0,d.P)(e.rut)}),(0,n.jsx)(a.nA,{className:"p-2 sm:p-4",children:"".concat(e.nombres," ").concat(e.apellidos)}),(0,n.jsx)(a.nA,{className:"hidden sm:table-cell p-2 sm:p-4",children:null==(s=e.sexo)?void 0:s.nombre}),(0,n.jsx)(a.nA,{className:"hidden md:table-cell p-2 sm:p-4",children:e.email}),(0,n.jsx)(a.nA,{className:"p-2 sm:p-4",children:null==(l=e.role)?void 0:l.nombre_rol}),(0,n.jsx)(a.nA,{className:"p-2 sm:p-4",children:(0,n.jsx)(x,{variant:e.status?"default":"secondary",children:e.status?"Activo":"Inactivo"})}),(0,n.jsx)(a.nA,{className:"text-right p-2 sm:p-4",children:(0,n.jsx)(t.$,{variant:"ghost",size:"sm",onClick:()=>{L(e),I(!0)},children:"Editar"})})]},e.rut)}):(0,n.jsx)(a.Hj,{children:(0,n.jsx)(a.nA,{colSpan:7,className:"h-24 text-center",children:"No se encontr\xf3 personal."})})})]}):(0,n.jsx)("div",{className:"h-24 text-center flex items-center justify-center",children:"No se encontr\xf3 personal."})})]})}),(0,n.jsxs)(i.Cf,{className:"sm:max-w-2xl",children:[(0,n.jsxs)(i.c7,{children:[(0,n.jsx)(i.L3,{className:"font-headline",children:"Nuevo Personal"}),(0,n.jsx)(i.rr,{children:"Complete los datos para crear una nueva cuenta."})]}),(0,n.jsx)(k,{onSuccess:e=>{h(s=>[e,...s]),A(!1)},sexos:N,roles:v})]}),B&&(0,n.jsx)(i.lG,{open:M,onOpenChange:I,children:(0,n.jsxs)(i.Cf,{className:"sm:max-w-2xl",children:[(0,n.jsxs)(i.c7,{children:[(0,n.jsx)(i.L3,{className:"font-headline",children:"Editar Personal"}),(0,n.jsx)(i.rr,{children:"Actualice los datos del miembro del personal."})]}),(0,n.jsx)(k,{staff:B,onSuccess:e=>{h(s=>s.map(s=>s.rut===e.rut?e:s)),I(!1),L(null)},sexos:N,roles:v})]})})]})}},9174:(e,s,l)=>{Promise.resolve().then(l.bind(l,4523))}},e=>{e.O(0,[972,934,491,122,576,358],()=>e(e.s=9174)),_N_E=e.O()}]);