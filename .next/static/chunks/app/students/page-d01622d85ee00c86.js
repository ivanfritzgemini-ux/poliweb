(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[935],{744:(e,s,n)=>{Promise.resolve().then(n.bind(n,5755))},5755:(e,s,n)=>{"use strict";n.d(s,{StudentList:()=>z});var l=n(7394),t=n(1658),r=n(8372),a=n(7656),c=n(7124),i=n(6952),d=n(7631),o=n(7206),x=n(2182),m=n(5414),h=n(2823),j=n(4942),u=n(9152),p=n(3364),N=n(925);let g=(0,N.createServerReference)("6048879be5dcba1d9e24c1762bb864cbe184f1d0aa",N.callServer,void 0,N.findSourceMapURL,"updateStudent");var f=n(8295),b=n(5071);let v=h.z.object({rut:h.z.string().refine(f.y,{message:"RUT inv\xe1lido."}),nombres:h.z.string().min(2,"Los nombres deben tener al menos 2 caracteres."),apellidos:h.z.string().min(2,"Los apellidos deben tener al menos 2 caracteres."),sexo_id:h.z.string({required_error:"Debe seleccionar un sexo."}),email:h.z.string().email("Email inv\xe1lido."),fecha_nacimiento:h.z.string({required_error:"Debe seleccionar una fecha de nacimiento."}),telefono:h.z.string().optional(),direccion:h.z.string().optional(),curso_id:h.z.string({required_error:"Debe seleccionar un curso."}),enrollmentDate:h.z.string({required_error:"Debe seleccionar una fecha de matr\xedcula."}),fecha_retiro:h.z.string().optional()});function C(e){var s,n;let{student:r,onSuccess:i,sexos:d,courses:o,nextId:h}=e,{toast:N}=(0,p.dj)(),[f,C]=(0,t.useState)(!1),S=(0,x.mN)({resolver:(0,m.u)(v),defaultValues:{rut:r.rut,nombres:r.nombres,apellidos:r.apellidos,sexo_id:(null==(s=r.sexo)?void 0:s.id)||"",email:r.email,fecha_nacimiento:r.fecha_nacimiento?r.fecha_nacimiento.substring(0,10):"",telefono:r.telefono||"",direccion:r.direccion||"",curso_id:(null==(n=r.curso)?void 0:n.id)||"",enrollmentDate:r.enrollmentDate?r.enrollmentDate.substring(0,10):"",fecha_retiro:r.fecha_retiro?r.fecha_retiro.substring(0,10):""}});async function _(e){C(!0);try{let s=await g(r.userId,{...e,fecha_nacimiento:new Date(e.fecha_nacimiento).toISOString(),fecha_matricula:new Date(e.enrollmentDate).toISOString(),fecha_retiro:e.fecha_retiro?new Date(e.fecha_retiro).toISOString():null});onStudentUpdated(s),N({title:"Estudiante Actualizado",description:"".concat(e.nombres," ").concat(e.apellidos," ha sido actualizado.")})}catch(e){N({title:"Error al actualizar estudiante",description:e.message||"Ocurri\xf3 un error desconocido.",variant:"destructive"})}finally{C(!1)}}return(0,l.jsx)(j.lV,{...S,children:(0,l.jsxs)("form",{onSubmit:S.handleSubmit(_),className:"grid grid-cols-2 gap-x-8 gap-y-4 pt-4",children:[(0,l.jsx)(j.zB,{control:S.control,name:"rut",render:e=>{let{field:s}=e;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.lR,{className:"text-xs sm:text-sm",children:"RUT"}),(0,l.jsx)(j.MJ,{children:(0,l.jsx)(c.p,{...s,disabled:!0})}),(0,l.jsx)(j.C5,{className:"text-xs sm:text-sm"})]})}}),(0,l.jsx)(j.zB,{control:S.control,name:"email",render:e=>{let{field:s}=e;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.lR,{className:"text-xs sm:text-sm",children:"Email"}),(0,l.jsx)(j.MJ,{children:(0,l.jsx)(c.p,{...s,disabled:!0})}),(0,l.jsx)(j.C5,{className:"text-xs sm:text-sm"})]})}}),(0,l.jsx)(j.zB,{control:S.control,name:"nombres",render:e=>{let{field:s}=e;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.lR,{className:"text-xs sm:text-sm",children:"Nombres*"}),(0,l.jsx)(j.MJ,{children:(0,l.jsx)(c.p,{placeholder:"Ej: Juan",...s})}),(0,l.jsx)(j.C5,{className:"text-xs sm:text-sm"})]})}}),(0,l.jsx)(j.zB,{control:S.control,name:"apellidos",render:e=>{let{field:s}=e;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.lR,{className:"text-xs sm:text-sm",children:"Apellidos*"}),(0,l.jsx)(j.MJ,{children:(0,l.jsx)(c.p,{placeholder:"Ej: P\xe9rez",...s})}),(0,l.jsx)(j.C5,{className:"text-xs sm:text-sm"})]})}}),(0,l.jsx)(j.zB,{control:S.control,name:"sexo_id",render:e=>{let{field:s}=e;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.lR,{className:"text-xs sm:text-sm",children:"Sexo*"}),(0,l.jsxs)(u.l6,{onValueChange:s.onChange,value:s.value,children:[(0,l.jsx)(j.MJ,{children:(0,l.jsx)(u.bq,{children:(0,l.jsx)(u.yv,{placeholder:"Seleccione el sexo"})})}),(0,l.jsx)(u.gC,{children:d.map(e=>(0,l.jsx)(u.eb,{value:e.id,children:e.nombre},e.id))})]}),(0,l.jsx)(j.C5,{className:"text-xs sm:text-sm"})]})}}),(0,l.jsx)(j.zB,{control:S.control,name:"curso_id",render:e=>{let{field:s}=e;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.lR,{className:"text-xs sm:text-sm",children:"Curso*"}),(0,l.jsxs)(u.l6,{onValueChange:s.onChange,value:s.value,children:[(0,l.jsx)(j.MJ,{children:(0,l.jsx)(u.bq,{children:(0,l.jsx)(u.yv,{placeholder:"Seleccione un curso"})})}),(0,l.jsx)(u.gC,{children:o.map(e=>(0,l.jsx)(u.eb,{value:e.id,children:e.nombre},e.id))})]}),(0,l.jsx)(j.C5,{className:"text-xs sm:text-sm"})]})}}),(0,l.jsx)(j.zB,{control:S.control,name:"fecha_nacimiento",render:e=>{let{field:s}=e;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.lR,{className:"text-xs sm:text-sm",children:"Fecha de Nacimiento*"}),(0,l.jsx)(j.MJ,{children:(0,l.jsx)(c.p,{type:"date",...s,value:s.value?s.value.substring(0,10):""})}),(0,l.jsx)(j.C5,{className:"text-xs sm:text-sm"})]})}}),(0,l.jsx)(j.zB,{control:S.control,name:"enrollmentDate",render:e=>{let{field:s}=e;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.lR,{className:"text-xs sm:text-sm",children:"Fecha de Matr\xedcula*"}),(0,l.jsx)(j.MJ,{children:(0,l.jsx)(c.p,{type:"date",...s,value:s.value?s.value.substring(0,10):""})}),(0,l.jsx)(j.C5,{className:"text-xs sm:text-sm"})]})}}),(0,l.jsx)(j.zB,{control:S.control,name:"telefono",render:e=>{let{field:s}=e;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.lR,{className:"text-xs sm:text-sm",children:"Tel\xe9fono"}),(0,l.jsx)(j.MJ,{children:(0,l.jsx)(c.p,{placeholder:"Ej: +56912345678",...s})}),(0,l.jsx)(j.C5,{className:"text-xs sm:text-sm"})]})}}),(0,l.jsx)(j.zB,{control:S.control,name:"direccion",render:e=>{let{field:s}=e;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.lR,{className:"text-xs sm:text-sm",children:"Direcci\xf3n"}),(0,l.jsx)(j.MJ,{children:(0,l.jsx)(c.p,{placeholder:"Ej: Calle Falsa 123",...s})}),(0,l.jsx)(j.C5,{className:"text-xs sm:text-sm"})]})}}),(0,l.jsx)(j.zB,{control:S.control,name:"fecha_retiro",render:e=>{let{field:s}=e;return(0,l.jsxs)(j.eI,{className:"col-span-2",children:[(0,l.jsx)(j.lR,{className:"text-xs sm:text-sm",children:"Fecha de Retiro"}),(0,l.jsx)(j.MJ,{children:(0,l.jsx)(c.p,{type:"date",...s,value:s.value?s.value.substring(0,10):""})}),(0,l.jsx)(j.C5,{className:"text-xs sm:text-sm"})]})}}),(0,l.jsx)("div",{className:"col-span-2 flex justify-end pt-2",children:(0,l.jsxs)(a.$,{type:"submit",disabled:f,children:[f&&(0,l.jsx)(b.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Actualizar Estudiante"]})})]})})}var S=n(8458),_=n(209);function z(e){let{initialStudents:s,initialSexos:n,initialCourses:x}=e,[m,h]=(0,t.useState)(s),[j,u]=(0,t.useState)(n),[N,g]=(0,t.useState)(x),[f,b]=(0,t.useState)(!1),[v,z]=(0,t.useState)(""),[w,A]=(0,t.useState)(!1),[I,D]=(0,t.useState)(!1),[E,M]=(0,t.useState)(null),{toast:R}=(0,p.dj)(),y=(0,t.useMemo)(()=>m.filter(e=>"".concat(e.nombres," ").concat(e.apellidos).toLowerCase().includes(v.toLowerCase())||e.id.toLowerCase().includes(v.toLowerCase())||e.grade.toLowerCase().includes(v.toLowerCase())),[m,v]),L=(0,t.useMemo)(()=>{if(0===m.length)return 0;let e=Math.max(...m.map(e=>parseInt(e.id,10)));return isFinite(e)?e:0},[m]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(i.lG,{open:w,onOpenChange:A,children:[(0,l.jsx)(S.Zp,{children:(0,l.jsxs)(S.Wu,{className:"p-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between gap-4 mb-4",children:[(0,l.jsxs)("div",{className:"relative w-full max-w-sm",children:[(0,l.jsx)(d.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,l.jsx)(c.p,{placeholder:"Buscar por nombre, ID, grado...",value:v,onChange:e=>z(e.target.value),className:"pl-10"})]}),(0,l.jsx)(i.zM,{asChild:!0,children:(0,l.jsxs)(a.$,{children:[(0,l.jsx)(o.A,{className:"mr-2 h-4 w-4"}),"Matricular Estudiante"]})})]}),(0,l.jsx)("div",{className:"rounded-lg border",children:0!==m.length||f?f?(0,l.jsx)(()=>(0,l.jsxs)(r.XI,{children:[(0,l.jsx)(r.A0,{children:(0,l.jsx)(r.Hj,{children:[...Array(10)].map((e,s)=>(0,l.jsx)(r.nd,{children:(0,l.jsx)(_.E,{className:"h-5 w-full"})},s))},"skeleton-header")}),(0,l.jsx)(r.BF,{children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,l.jsx)(r.Hj,{children:(0,l.jsx)(r.nA,{colSpan:10,children:(0,l.jsx)(_.E,{className:"h-8 w-full"})})},s))})]}),{}):(0,l.jsxs)(r.XI,{children:[(0,l.jsx)(r.A0,{children:(0,l.jsxs)(r.Hj,{children:[(0,l.jsx)(r.nd,{className:"w-[100px]",children:"N\xba Registro"}),(0,l.jsx)(r.nd,{children:"RUT"}),(0,l.jsx)(r.nd,{children:"Nombre"}),(0,l.jsx)(r.nd,{className:"hidden md:table-cell",children:"Sexo"}),(0,l.jsx)(r.nd,{className:"hidden lg:table-cell",children:"Fec. Nacimiento"}),(0,l.jsx)(r.nd,{children:"Curso"}),(0,l.jsx)(r.nd,{className:"hidden lg:table-cell",children:"Fec. Matr\xedcula"}),(0,l.jsx)(r.nd,{className:"hidden lg:table-cell",children:"Fec. Retiro"}),(0,l.jsx)(r.nd,{className:"text-right w-[100px]",children:"Acciones"})]})}),(0,l.jsx)(r.BF,{children:y.length>0?y.map(e=>{var s;return(0,l.jsxs)(r.Hj,{children:[(0,l.jsx)(r.nA,{className:"font-medium",children:e.id}),(0,l.jsx)(r.nA,{children:e.rut}),(0,l.jsx)(r.nA,{children:(0,l.jsx)("div",{className:"flex items-center gap-2",children:"".concat(e.nombres," ").concat(e.apellidos)})}),(0,l.jsx)(r.nA,{className:"hidden md:table-cell",children:null==(s=e.sexo)?void 0:s.nombre}),(0,l.jsx)(r.nA,{className:"hidden lg:table-cell",children:new Date(e.fecha_nacimiento).toLocaleDateString("es-ES",{timeZone:"UTC"})}),(0,l.jsx)(r.nA,{children:e.grade}),(0,l.jsx)(r.nA,{className:"hidden lg:table-cell",children:new Date(e.enrollmentDate).toLocaleDateString("es-ES",{timeZone:"UTC"})}),(0,l.jsx)(r.nA,{className:"hidden lg:table-cell",children:e.fecha_retiro?new Date(e.fecha_retiro).toLocaleDateString("es-ES",{timeZone:"UTC"}):"-"}),(0,l.jsx)(r.nA,{className:"text-right",children:(0,l.jsx)(a.$,{variant:"ghost",size:"sm",onClick:()=>{M(e),D(!0)},children:"Editar"})})]},e.id)}):(0,l.jsx)(r.Hj,{children:(0,l.jsx)(r.nA,{colSpan:10,className:"h-24 text-center",children:"No se encontraron estudiantes."})})})]}):(0,l.jsx)("div",{className:"h-24 text-center flex items-center justify-center",children:"No se encontraron estudiantes."})})]})}),(0,l.jsxs)(i.Cf,{className:"sm:max-w-2xl",children:[(0,l.jsxs)(i.c7,{children:[(0,l.jsx)(i.L3,{className:"font-headline",children:"Matricular Nuevo Estudiante"}),(0,l.jsx)(i.rr,{children:"Complete los detalles a continuaci\xf3n para registrar a un nuevo estudiante. Se generar\xe1 una foto de perfil por IA si no se carga una."})]}),(0,l.jsx)(C,{onSuccess:e=>{h(s=>[...s,e].sort((e,s)=>parseInt(e.id,10)-parseInt(s.id,10))),A(!1)},nextId:L+1,sexos:j,courses:N})]})]}),E&&(0,l.jsx)(i.lG,{open:I,onOpenChange:D,children:(0,l.jsxs)(i.Cf,{className:"sm:max-w-2xl",children:[(0,l.jsxs)(i.c7,{children:[(0,l.jsx)(i.L3,{className:"font-headline",children:"Editar Estudiante"}),(0,l.jsx)(i.rr,{children:"Actualice los datos del estudiante."})]}),(0,l.jsx)(C,{student:E,onSuccess:e=>{h(s=>s.map(s=>s.id===e.id?e:s)),D(!1)},sexos:j,courses:N})]})})]})}}},e=>{e.O(0,[972,934,491,122,576,358],()=>e(e.s=744)),_N_E=e.O()}]);