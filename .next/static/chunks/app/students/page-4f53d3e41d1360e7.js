(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[935],{1150:(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"default",{enumerable:!0,get:function(){return i}});let n=t(5155),r=t(2115),a=t(4437);function l(e){return{default:e&&"default"in e?e.default:e}}t(6552);let c={loader:()=>Promise.resolve(l(()=>null)),loading:null,ssr:!0},i=function(e){let s={...c,...e},t=(0,r.lazy)(()=>s.loader().then(l)),i=s.loading;function o(e){let l=i?(0,n.jsx)(i,{isLoading:!0,pastDelay:!0,error:null}):null,c=!s.ssr||!!s.loading,o=c?r.Suspense:r.Fragment,d=s.ssr?(0,n.jsxs)(n.Fragment,{children:[null,(0,n.jsx)(t,{...e})]}):(0,n.jsx)(a.BailoutToCSR,{reason:"next/dynamic",children:(0,n.jsx)(t,{...e})});return(0,n.jsx)(o,{...c?{fallback:l}:{},children:d})}return o.displayName="LoadableComponent",o}},1544:(e,s,t)=>{"use strict";t.d(s,{StudentList:()=>I});var n=t(5155),r=t(2115),a=t(7270),l=t(3998),c=t(5142),i=t(1834),o=t(109),d=t(2452),u=t(6278),x=t.n(u),m=t(2544),h=t(6942),j=t(5653),p=t(3281),f=t(1186),b=t(5894),g=t(926);let w=(0,g.createServerReference)("606302831770c65338865903cb0870eefa29d345a0",g.callServer,void 0,g.findSourceMapURL,"updateStudent");var v=t(4269),N=t(2033);let S=j.z.object({rut:j.z.string().refine(v.y,{message:"RUT inv\xe1lido."}),nombres:j.z.string().min(2,"Los nombres deben tener al menos 2 caracteres."),apellidos:j.z.string().min(2,"Los apellidos deben tener al menos 2 caracteres."),sexo_id:j.z.string({required_error:"Debe seleccionar un sexo."}),email:j.z.string().email("Email inv\xe1lido."),fecha_nacimiento:j.z.string({required_error:"Debe seleccionar una fecha de nacimiento."}),telefono:j.z.string().optional(),direccion:j.z.string().optional(),curso_id:j.z.string({required_error:"Debe seleccionar un curso."}),enrollmentDate:j.z.string({required_error:"Debe seleccionar una fecha de matr\xedcula."}),fecha_retiro:j.z.string().optional()});function _(e){var s,t;let{student:a,onStudentUpdated:i,sexos:o,courses:d}=e,{toast:u}=(0,b.dj)(),[x,j]=(0,r.useState)(!1),g=(0,m.mN)({resolver:(0,h.u)(S),defaultValues:{rut:a.rut,nombres:a.nombres,apellidos:a.apellidos,sexo_id:(null==(s=a.sexo)?void 0:s.id)||"",email:a.email,fecha_nacimiento:a.fecha_nacimiento?a.fecha_nacimiento.substring(0,10):"",telefono:a.telefono||"",direccion:a.direccion||"",curso_id:(null==(t=a.curso)?void 0:t.id)||"",enrollmentDate:a.enrollmentDate?a.enrollmentDate.substring(0,10):"",fecha_retiro:a.fecha_retiro?a.fecha_retiro.substring(0,10):""}});async function v(e){j(!0);try{let s=await w(a.userId,{...e,fecha_nacimiento:new Date(e.fecha_nacimiento).toISOString(),fecha_matricula:new Date(e.enrollmentDate).toISOString(),fecha_retiro:e.fecha_retiro?new Date(e.fecha_retiro).toISOString():null});i(s),u({title:"Estudiante Actualizado",description:"".concat(e.nombres," ").concat(e.apellidos," ha sido actualizado.")})}catch(e){u({title:"Error al actualizar estudiante",description:e.message||"Ocurri\xf3 un error desconocido.",variant:"destructive"})}finally{j(!1)}}return(0,n.jsx)(p.lV,{...g,children:(0,n.jsxs)("form",{onSubmit:g.handleSubmit(v),className:"grid grid-cols-2 gap-x-8 gap-y-4 pt-4",children:[(0,n.jsx)(p.zB,{control:g.control,name:"rut",render:e=>{let{field:s}=e;return(0,n.jsxs)(p.eI,{children:[(0,n.jsx)(p.lR,{className:"text-xs sm:text-sm",children:"RUT"}),(0,n.jsx)(p.MJ,{children:(0,n.jsx)(c.p,{...s,disabled:!0})}),(0,n.jsx)(p.C5,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)(p.zB,{control:g.control,name:"email",render:e=>{let{field:s}=e;return(0,n.jsxs)(p.eI,{children:[(0,n.jsx)(p.lR,{className:"text-xs sm:text-sm",children:"Email"}),(0,n.jsx)(p.MJ,{children:(0,n.jsx)(c.p,{...s,disabled:!0})}),(0,n.jsx)(p.C5,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)(p.zB,{control:g.control,name:"nombres",render:e=>{let{field:s}=e;return(0,n.jsxs)(p.eI,{children:[(0,n.jsx)(p.lR,{className:"text-xs sm:text-sm",children:"Nombres*"}),(0,n.jsx)(p.MJ,{children:(0,n.jsx)(c.p,{placeholder:"Ej: Juan",...s})}),(0,n.jsx)(p.C5,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)(p.zB,{control:g.control,name:"apellidos",render:e=>{let{field:s}=e;return(0,n.jsxs)(p.eI,{children:[(0,n.jsx)(p.lR,{className:"text-xs sm:text-sm",children:"Apellidos*"}),(0,n.jsx)(p.MJ,{children:(0,n.jsx)(c.p,{placeholder:"Ej: P\xe9rez",...s})}),(0,n.jsx)(p.C5,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)(p.zB,{control:g.control,name:"sexo_id",render:e=>{let{field:s}=e;return(0,n.jsxs)(p.eI,{children:[(0,n.jsx)(p.lR,{className:"text-xs sm:text-sm",children:"Sexo*"}),(0,n.jsxs)(f.l6,{onValueChange:s.onChange,value:s.value,children:[(0,n.jsx)(p.MJ,{children:(0,n.jsx)(f.bq,{children:(0,n.jsx)(f.yv,{placeholder:"Seleccione el sexo"})})}),(0,n.jsx)(f.gC,{children:o.map(e=>(0,n.jsx)(f.eb,{value:e.id,children:e.nombre},e.id))})]}),(0,n.jsx)(p.C5,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)(p.zB,{control:g.control,name:"curso_id",render:e=>{let{field:s}=e;return(0,n.jsxs)(p.eI,{children:[(0,n.jsx)(p.lR,{className:"text-xs sm:text-sm",children:"Curso*"}),(0,n.jsxs)(f.l6,{onValueChange:s.onChange,value:s.value,children:[(0,n.jsx)(p.MJ,{children:(0,n.jsx)(f.bq,{children:(0,n.jsx)(f.yv,{placeholder:"Seleccione un curso"})})}),(0,n.jsx)(f.gC,{children:d.map(e=>(0,n.jsx)(f.eb,{value:e.id,children:e.nombre},e.id))})]}),(0,n.jsx)(p.C5,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)(p.zB,{control:g.control,name:"fecha_nacimiento",render:e=>{let{field:s}=e;return(0,n.jsxs)(p.eI,{children:[(0,n.jsx)(p.lR,{className:"text-xs sm:text-sm",children:"Fecha de Nacimiento*"}),(0,n.jsx)(p.MJ,{children:(0,n.jsx)(c.p,{type:"date",...s,value:s.value?s.value.substring(0,10):""})}),(0,n.jsx)(p.C5,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)(p.zB,{control:g.control,name:"enrollmentDate",render:e=>{let{field:s}=e;return(0,n.jsxs)(p.eI,{children:[(0,n.jsx)(p.lR,{className:"text-xs sm:text-sm",children:"Fecha de Matr\xedcula*"}),(0,n.jsx)(p.MJ,{children:(0,n.jsx)(c.p,{type:"date",...s,value:s.value?s.value.substring(0,10):""})}),(0,n.jsx)(p.C5,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)(p.zB,{control:g.control,name:"telefono",render:e=>{let{field:s}=e;return(0,n.jsxs)(p.eI,{children:[(0,n.jsx)(p.lR,{className:"text-xs sm:text-sm",children:"Tel\xe9fono"}),(0,n.jsx)(p.MJ,{children:(0,n.jsx)(c.p,{placeholder:"Ej: +56912345678",...s})}),(0,n.jsx)(p.C5,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)(p.zB,{control:g.control,name:"direccion",render:e=>{let{field:s}=e;return(0,n.jsxs)(p.eI,{children:[(0,n.jsx)(p.lR,{className:"text-xs sm:text-sm",children:"Direcci\xf3n"}),(0,n.jsx)(p.MJ,{children:(0,n.jsx)(c.p,{placeholder:"Ej: Calle Falsa 123",...s})}),(0,n.jsx)(p.C5,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)(p.zB,{control:g.control,name:"fecha_retiro",render:e=>{let{field:s}=e;return(0,n.jsxs)(p.eI,{className:"col-span-2",children:[(0,n.jsx)(p.lR,{className:"text-xs sm:text-sm",children:"Fecha de Retiro"}),(0,n.jsx)(p.MJ,{children:(0,n.jsx)(c.p,{type:"date",...s,value:s.value?s.value.substring(0,10):""})}),(0,n.jsx)(p.C5,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)("div",{className:"col-span-2 flex justify-end pt-2",children:(0,n.jsxs)(l.$,{type:"submit",disabled:x,children:[x&&(0,n.jsx)(N.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Actualizar Estudiante"]})})]})})}var y=t(6948);let C=(0,g.createServerReference)("60713247e77ce4cb6d2a2f7f2be558bd1e8f9ed33b",g.callServer,void 0,g.findSourceMapURL,"getStudents");var M=t(788),A=t(8077),E=t(243),z=t(3402);let R=x()(()=>t.e(121).then(t.bind(t,7121)).then(e=>e.EnrollStudentForm),{loadableGenerated:{webpack:()=>[7121]},ssr:!1});function I(){let[e,s]=(0,r.useState)([]),[t,u]=(0,r.useState)([]),[x,m]=(0,r.useState)([]),[h,j]=(0,r.useState)(!0),[p,f]=(0,r.useState)(""),[g,w]=(0,r.useState)(!1),[v,N]=(0,r.useState)(!1),[S,I]=(0,r.useState)(null),[O,D]=(0,r.useState)(1),[L]=(0,r.useState)(10),[P,B]=(0,r.useState)(0),{toast:k}=(0,b.dj)(),U=(0,r.useMemo)(()=>Math.ceil(P/L),[P,L]);(0,r.useEffect)(()=>{let e=async()=>{try{let[e,s]=await Promise.all([(0,M.T)(),(0,A.N)()]);u(e),m(s)}catch(e){k({title:"Error al cargar datos complementarios",description:"No se pudieron cargar los datos de sexos y cursos.",variant:"destructive"})}};(async()=>{j(!0);try{let{students:e,totalCount:t}=await C(O,L),n=e.sort((e,s)=>parseInt(e.id,10)-parseInt(s.id,10));s(n),B(t)}catch(e){k({title:"Error al cargar estudiantes",description:"No se pudieron cargar los datos de los estudiantes.",variant:"destructive"})}finally{j(!1)}})(),e()},[O,L,k]);let F=(0,r.useMemo)(()=>e.filter(e=>"".concat(e.nombres," ").concat(e.apellidos).toLowerCase().includes(p.toLowerCase())||e.id.toLowerCase().includes(p.toLowerCase())||e.grade.toLowerCase().includes(p.toLowerCase())),[e,p]),T=(0,r.useMemo)(()=>{let e=(O-1)*L;return F.slice(e,e+L)},[F,O,L]),J=e=>{D(e)},q=(O-1)*L,H=Math.min(q+L,F.length);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(i.lG,{open:g,onOpenChange:w,children:[(0,n.jsx)(y.Zp,{children:(0,n.jsxs)(y.Wu,{className:"p-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between gap-4 mb-4",children:[(0,n.jsxs)("div",{className:"relative w-full max-w-sm",children:[(0,n.jsx)(o.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,n.jsx)(c.p,{placeholder:"Buscar por nombre, ID, grado...",value:p,onChange:e=>{f(e.target.value),D(1)},className:"pl-10"})]}),(0,n.jsx)(i.zM,{asChild:!0,children:(0,n.jsxs)(l.$,{children:[(0,n.jsx)(d.A,{className:"mr-2 h-4 w-4"}),"Matricular Estudiante"]})})]}),(0,n.jsx)("div",{className:"rounded-lg border w-full",children:h?(0,n.jsx)(()=>(0,n.jsxs)(a.XI,{children:[(0,n.jsx)(a.A0,{children:(0,n.jsx)(a.Hj,{children:[...Array(10)].map((e,s)=>(0,n.jsx)(a.nd,{children:(0,n.jsx)(E.E,{className:"h-5 w-full"})},s))},"skeleton-header")}),(0,n.jsx)(a.BF,{children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,n.jsx)(a.Hj,{children:(0,n.jsx)(a.nA,{colSpan:10,children:(0,n.jsx)(E.E,{className:"h-8 w-full"})})},s))})]}),{}):(0,n.jsxs)(a.XI,{className:"w-full min-w-0 text-sm",children:[(0,n.jsx)(a.A0,{children:(0,n.jsxs)(a.Hj,{children:[(0,n.jsx)(a.nd,{className:"whitespace-nowrap",children:"N\xba Registro"}),(0,n.jsx)(a.nd,{className:"whitespace-nowrap",children:"RUT"}),(0,n.jsx)(a.nd,{className:"whitespace-nowrap",children:"Nombre"}),(0,n.jsx)(a.nd,{className:"hidden md:table-cell whitespace-nowrap",children:"Sexo"}),(0,n.jsx)(a.nd,{className:"hidden lg:table-cell whitespace-nowrap",children:"Fec. Nacimiento"}),(0,n.jsx)(a.nd,{className:"whitespace-nowrap",children:"Curso"}),(0,n.jsx)(a.nd,{className:"hidden lg:table-cell whitespace-nowrap",children:"Fec. Matr\xedcula"}),(0,n.jsx)(a.nd,{className:"hidden lg:table-cell whitespace-nowrap",children:"Fec. Retiro"}),(0,n.jsx)(a.nd,{className:"text-right whitespace-nowrap",children:"Acciones"})]})}),(0,n.jsx)(a.BF,{children:T.length>0?T.map(e=>{var s;return(0,n.jsxs)(a.Hj,{children:[(0,n.jsx)(a.nA,{className:"font-medium whitespace-nowrap",children:e.id}),(0,n.jsx)(a.nA,{className:"whitespace-nowrap",children:e.rut}),(0,n.jsx)(a.nA,{className:"whitespace-nowrap",children:(0,n.jsx)("div",{className:"flex items-center gap-2 whitespace-nowrap",children:"".concat(e.nombres," ").concat(e.apellidos)})}),(0,n.jsx)(a.nA,{className:"hidden md:table-cell whitespace-nowrap",children:null==(s=e.sexo)?void 0:s.nombre}),(0,n.jsx)(a.nA,{className:"hidden lg:table-cell whitespace-nowrap",children:new Date(e.fecha_nacimiento).toLocaleDateString("es-ES",{timeZone:"UTC"})}),(0,n.jsx)(a.nA,{className:"whitespace-nowrap",children:e.grade}),(0,n.jsx)(a.nA,{className:"hidden lg:table-cell whitespace-nowrap",children:new Date(e.enrollmentDate).toLocaleDateString("es-ES",{timeZone:"UTC"})}),(0,n.jsx)(a.nA,{className:"hidden lg:table-cell whitespace-nowrap",children:e.fecha_retiro?new Date(e.fecha_retiro).toLocaleDateString("es-ES",{timeZone:"UTC"}):"-"}),(0,n.jsx)(a.nA,{className:"text-right whitespace-nowrap",children:(0,n.jsx)(l.$,{variant:"ghost",size:"sm",onClick:()=>handleEditClick(e),children:"Editar"})})]},e.id)}):(0,n.jsx)(a.Hj,{children:(0,n.jsx)(a.nA,{colSpan:10,className:"h-24 text-center whitespace-nowrap",children:"No se encontraron estudiantes."})})})]})}),(0,n.jsxs)("div",{className:"flex items-center justify-between pt-4",children:[(0,n.jsxs)("div",{className:"text-sm text-muted-foreground whitespace-nowrap",children:["Mostrando ",H>0?q+1:0," a ",H," de ",P," estudiantes"]}),U>1&&(0,n.jsx)(z.dK,{className:"ml-auto",children:(0,n.jsxs)(z.Iu,{children:[(0,n.jsx)(z.cU,{children:(0,n.jsx)(z.Eb,{href:"#",onClick:e=>{e.preventDefault(),J(Math.max(1,O-1))},disabled:1===O})}),(0,n.jsx)(z.cU,{children:(0,n.jsxs)("span",{className:"text-sm font-medium text-muted-foreground",children:["P\xe1gina ",O," de ",U]})}),(0,n.jsx)(z.cU,{children:(0,n.jsx)(z.WA,{href:"#",onClick:e=>{e.preventDefault(),J(Math.min(U,O+1))},disabled:O===U})})]})})]})]})}),(0,n.jsxs)(i.Cf,{className:"sm:max-w-2xl",children:[(0,n.jsxs)(i.c7,{children:[(0,n.jsx)(i.L3,{className:"font-headline",children:"Matricular Nuevo Estudiante"}),(0,n.jsx)(i.rr,{children:"Complete los detalles a continuaci\xf3n para registrar a un nuevo estudiante. Se generar\xe1 una foto de perfil por IA si no se carga una."})]}),g&&(0,n.jsx)(R,{onStudentAdded:handleAddStudent,nextId:maxId+1,sexos:t,courses:x})]})]}),S&&(0,n.jsx)(i.lG,{open:v,onOpenChange:N,children:(0,n.jsxs)(i.Cf,{className:"sm:max-w-2xl",children:[(0,n.jsxs)(i.c7,{children:[(0,n.jsx)(i.L3,{className:"font-headline",children:"Editar Estudiante"}),(0,n.jsx)(i.rr,{children:"Actualice los datos del estudiante."})]}),(0,n.jsx)(_,{student:S,onStudentUpdated:handleStudentUpdated,sexos:t,courses:x})]})})]})}},3707:(e,s,t)=>{Promise.resolve().then(t.bind(t,1544))},4054:(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),!function(e,s){for(var t in s)Object.defineProperty(e,t,{enumerable:!0,get:s[t]})}(s,{bindSnapshot:function(){return l},createAsyncLocalStorage:function(){return a},createSnapshot:function(){return c}});let t=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class n{disable(){throw t}getStore(){}run(){throw t}exit(){throw t}enterWith(){throw t}static bind(e){return e}}let r="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function a(){return r?new r:new n}function l(e){return r?r.bind(e):n.bind(e)}function c(){return r?r.snapshot():function(e,...s){return e(...s)}}},4437:(e,s,t)=>{"use strict";function n(e){let{reason:s,children:t}=e;return t}Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"BailoutToCSR",{enumerable:!0,get:function(){return n}}),t(4553)},6278:(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"default",{enumerable:!0,get:function(){return r}});let n=t(8140)._(t(1150));function r(e,s){var t;let r={};"function"==typeof e&&(r.loader=e);let a={...r,...s};return(0,n.default)({...a,modules:null==(t=a.loadableGenerated)?void 0:t.modules})}("function"==typeof s.default||"object"==typeof s.default&&null!==s.default)&&void 0===s.default.__esModule&&(Object.defineProperty(s.default,"__esModule",{value:!0}),Object.assign(s.default,s),e.exports=s.default)},6552:(e,s,t)=>{"use strict";function n(e){let{moduleIds:s}=e;return null}Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"PreloadChunks",{enumerable:!0,get:function(){return n}}),t(5155),t(7650),t(8567),t(7278)},7828:(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"workAsyncStorageInstance",{enumerable:!0,get:function(){return n}});let n=(0,t(4054).createAsyncLocalStorage)()},8077:(e,s,t)=>{"use strict";t.d(s,{N:()=>r});var n=t(926);let r=(0,n.createServerReference)("008a90e06fcfebcb5d2335cb3620a29c2cbe9ac207",n.callServer,void 0,n.findSourceMapURL,"getCourses")},8567:(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"workAsyncStorage",{enumerable:!0,get:function(){return n.workAsyncStorageInstance}});let n=t(7828)}},e=>{e.O(0,[118,331,644,291,441,255,358],()=>e(e.s=3707)),_N_E=e.O()}]);