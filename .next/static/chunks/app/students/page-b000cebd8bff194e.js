(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[935],{560:(e,r,a)=>{"use strict";a.d(r,{StudentList:()=>A});var s=a(5155),l=a(2115),n=a(7270),t=a(3998),i=a(5142),c=a(1834),d=a(109),o=a(2452),u=a(2544),h=a(6942),x=a(5653),m=a(3281),j=a(2492),f=a(926);let p=(0,f.createServerReference)("00c9075a2cf79d9dff5967ea3eb1df35e4c2c70969",f.callServer,void 0,f.findSourceMapURL,"getCourses"),g=(0,f.createServerReference)("40d5f5d9bd38fc8b806ae0e5ba11b05a7925f0f239",f.callServer,void 0,f.findSourceMapURL,"getRoleIdByName"),v=(0,f.createServerReference)("402c445831608a8b6991a61253b3bfedde7fbf0193",f.callServer,void 0,f.findSourceMapURL,"getStaffByRut"),b=(0,f.createServerReference)("60b06bad246d2f29f03978d62889a0c5c9613b4f9a",f.callServer,void 0,f.findSourceMapURL,"createUser"),N=(0,f.createServerReference)("40412ced06f1e0dac4bb04e21b535a74ec0ab0ce8c",f.callServer,void 0,f.findSourceMapURL,"addStudent");var S=a(1330),y=a(5894);let w=(0,a(4294).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var M=a(4269),C=a(1186);let D=x.z.object({id:x.z.string().min(1,"El n\xfamero de registro es requerido."),rut:x.z.string().refine(M.y,{message:"RUT inv\xe1lido."}),nombres:x.z.string().min(2,"El nombre debe tener al menos 2 caracteres."),apellidos:x.z.string().min(2,"Los apellidos deben tener al menos 2 caracteres."),sexo_id:x.z.string({required_error:"Debe seleccionar un sexo."}),fecha_nacimiento:x.z.string({required_error:"Debe seleccionar una fecha de nacimiento."}).refine(e=>{let r=new Date(e),a=new Date().getFullYear(),s=r.getFullYear(),l=r.getMonth()+1,n=r.getDate();return!(isNaN(r.getTime())||s<1900||s>a||l<1||l>12||n<1||n>31||n>new Date(s,l,0).getDate())},{message:"La fecha de nacimiento no es v\xe1lida. Aseg\xfarese de que el formato sea DD/MM/YYYY y el a\xf1o est\xe9 entre 1900 y el actual."}),email:x.z.string().email("Email inv\xe1lido."),phone:x.z.string().min(5,"N\xfamero de tel\xe9fono inv\xe1lido.").optional().or(x.z.literal("")),address:x.z.string().min(5,"Direcci\xf3n inv\xe1lida.").optional().or(x.z.literal("")),curso_id:x.z.string({required_error:"Debe seleccionar un curso."}),enrollmentDate:x.z.string({required_error:"Debe seleccionar una fecha de matr\xedcula."}).refine(e=>{let r=new Date(e),a=new Date().getFullYear(),s=r.getFullYear(),l=r.getMonth()+1,n=r.getDate();return!(isNaN(r.getTime())||s<1900||s>a||l<1||l>12||n<1||n>31||n>new Date(s,l,0).getDate())},{message:"La fecha de matr\xedcula no es v\xe1lida. Aseg\xfarese de que el formato sea DD/MM/YYYY y el a\xf1o est\xe9 entre 1900 y el actual."})});function R(e){let{onStudentAdded:r,nextId:a,sexos:n,courses:c}=e,{toast:o}=(0,y.dj)(),[x,f]=(0,l.useState)(!1),[R,z]=(0,l.useState)(!1),[_,E]=(0,l.useState)(n),[A,L]=(0,l.useState)(c),B=(0,l.useRef)(null),[I,U]=(0,l.useState)(null),[F,J]=(0,l.useState)(null),T=(0,u.mN)({resolver:(0,h.u)(D),defaultValues:{id:String(a),rut:"",nombres:"",apellidos:"",sexo_id:"",fecha_nacimiento:"",email:"",phone:"",address:"",curso_id:"",enrollmentDate:new Date().toISOString().split("T")[0]}});(0,l.useEffect)(()=>{var e;null==(e=B.current)||e.focus()},[]),(0,l.useEffect)(()=>{!async function(){n&&0!==n.length||E(await (0,j.T)()),c&&0!==c.length||L(await p()),J(await g("Estudiante"))}()},[n,c]);let V=async()=>{let e=T.getValues("rut");if(!(0,M.y)(e))return void T.setError("rut",{type:"manual",message:"RUT inv\xe1lido."});z(!0);try{let r=await v(e);r?(U(r.id),T.setValue("nombres",r.nombres),T.setValue("apellidos",r.apellidos),T.setValue("email",r.email),T.setValue("phone",r.telefono||""),T.setValue("address",r.direccion||""),T.setValue("fecha_nacimiento",r.fecha_nacimiento?(0,S.GP)(new Date(r.fecha_nacimiento),"yyyy-MM-dd"):""),r.sexo&&T.setValue("sexo_id",r.sexo.id),o({title:"Persona Encontrada",description:"Datos cargados en el formulario."})):(U(null),o({title:"No Encontrado",description:"No se encontr\xf3 a nadie con ese RUT. Puede registrarlo manualmente.",variant:"destructive"}))}catch(e){o({title:"Error en la B\xfasqueda",description:e.message||"No se pudo realizar la b\xfasqueda.",variant:"destructive"})}finally{z(!1)}};async function Y(e){f(!0);try{var a;let s=I;s||(s=await b({rut:e.rut,nombres:e.nombres,apellidos:e.apellidos,email:e.email,phone:e.phone,address:e.address,sexo_id:e.sexo_id,fecha_nacimiento:e.fecha_nacimiento},F));let l="".concat(e.nombres," ").concat(e.apellidos);await N({...e,usuario:s});let n={...e,id:e.id,sexo:_.find(r=>r.id===e.sexo_id)||null,grade:(null==(a=A.find(r=>r.id===e.curso_id))?void 0:a.nombre)||""};r(n),o({title:"Estudiante Matriculado",description:"".concat(l," ha sido a\xf1adido exitosamente.")}),T.reset()}catch(e){o({title:"Error",description:e.message||"Ocurri\xf3 un error al matricular al estudiante.",variant:"destructive"})}finally{f(!1)}}return(0,s.jsx)(m.lV,{...T,children:(0,s.jsxs)("form",{onSubmit:T.handleSubmit(Y),className:"space-y-6",children:[(0,s.jsx)(m.zB,{control:T.control,name:"id",render:e=>{let{field:r}=e;return(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"N\xfamero de Registro"}),(0,s.jsx)(m.MJ,{children:(0,s.jsx)(i.p,{placeholder:"Ej: STU-001",...r,readOnly:!0})}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsxs)("div",{className:"flex items-end gap-2",children:[(0,s.jsx)(m.zB,{control:T.control,name:"rut",render:e=>{let{field:r}=e;return(0,s.jsxs)(m.eI,{className:"flex-grow",children:[(0,s.jsx)(m.lR,{children:"RUT"}),(0,s.jsx)(m.MJ,{children:(0,s.jsx)(i.p,{placeholder:"12.345.678-9",...r,ref:B,onBlur:e=>r.onChange((0,M.P)(e.target.value))})}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsxs)(t.$,{type:"button",onClick:V,disabled:R,className:"h-10",children:[R?(0,s.jsx)(w,{className:"h-4 w-4 animate-spin"}):(0,s.jsx)(d.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Buscar"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,s.jsx)(m.zB,{control:T.control,name:"nombres",render:e=>{let{field:r}=e;return(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"Nombre Completo"}),(0,s.jsx)(m.MJ,{children:(0,s.jsx)(i.p,{placeholder:"Ej: Juan P\xe9rez",...r})}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsx)(m.zB,{control:T.control,name:"apellidos",render:e=>{let{field:r}=e;return(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"Apellidos"}),(0,s.jsx)(m.MJ,{children:(0,s.jsx)(i.p,{placeholder:"Ej: P\xe9rez D\xedaz",...r})}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsx)(m.zB,{control:T.control,name:"enrollmentDate",render:e=>{let{field:r}=e;return(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"Fecha de Matr\xedcula"}),(0,s.jsx)(m.MJ,{children:(0,s.jsx)(i.p,{type:"date",...r,value:r.value?(0,S.GP)(new Date(r.value),"yyyy-MM-dd"):""})}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsx)(m.zB,{control:T.control,name:"curso_id",render:e=>{let{field:r}=e;return(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"Curso"}),(0,s.jsxs)(C.l6,{onValueChange:r.onChange,value:r.value,children:[(0,s.jsx)(m.MJ,{children:(0,s.jsx)(C.bq,{children:(0,s.jsx)(C.yv,{placeholder:"Seleccione un curso"})})}),(0,s.jsx)(C.gC,{children:A.map(e=>(0,s.jsx)(C.eb,{value:e.id,children:e.nombre},e.id))})]}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsx)(m.zB,{control:T.control,name:"email",render:e=>{let{field:r}=e;return(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"Email"}),(0,s.jsx)(m.MJ,{children:(0,s.jsx)(i.p,{placeholder:"ejemplo@email.com",...r})}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsx)(m.zB,{control:T.control,name:"sexo_id",render:e=>{let{field:r}=e;return(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"Sexo"}),(0,s.jsxs)(C.l6,{onValueChange:r.onChange,value:r.value,children:[(0,s.jsx)(m.MJ,{children:(0,s.jsx)(C.bq,{children:(0,s.jsx)(C.yv,{placeholder:"Seleccione el sexo"})})}),(0,s.jsx)(C.gC,{children:_.map(e=>(0,s.jsx)(C.eb,{value:e.id,children:e.nombre},e.id))})]}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsx)(m.zB,{control:T.control,name:"fecha_nacimiento",render:e=>{let{field:r}=e;return(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"Fecha de Nacimiento"}),(0,s.jsx)(m.MJ,{children:(0,s.jsx)(i.p,{type:"date",...r,value:r.value?(0,S.GP)(new Date(r.value),"yyyy-MM-dd"):""})}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsx)(m.zB,{control:T.control,name:"phone",render:e=>{let{field:r}=e;return(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"Tel\xe9fono"}),(0,s.jsx)(m.MJ,{children:(0,s.jsx)(i.p,{placeholder:"555-123-4567",...r})}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsx)(m.zB,{control:T.control,name:"address",render:e=>{let{field:r}=e;return(0,s.jsxs)(m.eI,{className:"sm:col-span-2",children:[(0,s.jsx)(m.lR,{children:"Direcci\xf3n"}),(0,s.jsx)(m.MJ,{children:(0,s.jsx)(i.p,{placeholder:"123 Calle Falsa, Ciudad",...r})}),(0,s.jsx)(m.C5,{})]})}})]}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsxs)(t.$,{type:"submit",disabled:x,className:"w-full sm:w-auto",children:[x&&(0,s.jsx)(w,{className:"mr-2 h-4 w-4 animate-spin"}),"Matricular Estudiante"]})})]})})}var z=a(6948);let _=(0,f.createServerReference)("00b1c0bc2cbb1a3f24622d31f5b50036efb14a55a6",f.callServer,void 0,f.findSourceMapURL,"getStudents");var E=a(243);function A(){let[e,r]=(0,l.useState)([]),[a,u]=(0,l.useState)([]),[h,x]=(0,l.useState)([]),[m,f]=(0,l.useState)(!0),[g,v]=(0,l.useState)(""),[b,N]=(0,l.useState)(!1),{toast:S}=(0,y.dj)();(0,l.useEffect)(()=>{(async()=>{f(!0);try{let[e,a,s]=await Promise.all([_(),(0,j.T)(),p()]);r(e),u(a),x(s)}catch(e){S({title:"Error al cargar datos",description:"No se pudieron cargar los datos iniciales.",variant:"destructive"})}finally{f(!1)}})()},[S]);let w=(0,l.useMemo)(()=>e.filter(e=>"".concat(e.nombres," ").concat(e.apellidos).toLowerCase().includes(g.toLowerCase())||e.id.toLowerCase().includes(g.toLowerCase())||e.grade.toLowerCase().includes(g.toLowerCase())),[e,g]),M=(0,l.useMemo)(()=>0===e.length?0:Math.max(...e.map(e=>parseInt(e.id,10))),[e]);return(0,s.jsxs)(c.lG,{open:b,onOpenChange:N,children:[(0,s.jsx)(z.Zp,{children:(0,s.jsxs)(z.Wu,{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-4 mb-4",children:[(0,s.jsxs)("div",{className:"relative w-full max-w-sm",children:[(0,s.jsx)(d.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(i.p,{placeholder:"Buscar por nombre, ID, grado...",value:g,onChange:e=>v(e.target.value),className:"pl-10"})]}),(0,s.jsx)(c.zM,{asChild:!0,children:(0,s.jsxs)(t.$,{children:[(0,s.jsx)(o.A,{className:"mr-2 h-4 w-4"}),"Matricular Estudiante"]})})]}),(0,s.jsx)("div",{className:"rounded-lg border",children:m?(0,s.jsx)(()=>(0,s.jsxs)(n.XI,{children:[(0,s.jsx)(n.A0,{children:(0,s.jsx)(n.Hj,{children:[...Array(10)].map((e,r)=>(0,s.jsx)(n.nd,{children:(0,s.jsx)(E.E,{className:"h-5 w-full"})},r))},"skeleton-header")}),(0,s.jsx)(n.BF,{children:[void 0,void 0,void 0,void 0,void 0].map((e,r)=>(0,s.jsx)(n.Hj,{children:(0,s.jsx)(n.nA,{colSpan:10,children:(0,s.jsx)(E.E,{className:"h-8 w-full"})})},r))})]}),{}):(0,s.jsxs)(n.XI,{children:[(0,s.jsx)(n.A0,{children:(0,s.jsxs)(n.Hj,{children:[(0,s.jsx)(n.nd,{className:"w-[100px]",children:"N\xba Registro"}),(0,s.jsx)(n.nd,{children:"RUT"}),(0,s.jsx)(n.nd,{children:"Nombre"}),(0,s.jsx)(n.nd,{className:"hidden md:table-cell",children:"Sexo"}),(0,s.jsx)(n.nd,{className:"hidden lg:table-cell",children:"Fec. Nacimiento"}),(0,s.jsx)(n.nd,{children:"Curso"}),(0,s.jsx)(n.nd,{className:"hidden lg:table-cell",children:"Fec. Matr\xedcula"}),(0,s.jsx)(n.nd,{className:"hidden lg:table-cell",children:"Fec. Retiro"}),(0,s.jsx)(n.nd,{className:"text-right w-[100px]",children:"Acciones"})]})}),(0,s.jsx)(n.BF,{children:w.length>0?w.map(e=>{var r;return(0,s.jsxs)(n.Hj,{children:[(0,s.jsx)(n.nA,{className:"font-medium",children:e.id}),(0,s.jsx)(n.nA,{children:e.rut}),(0,s.jsx)(n.nA,{children:(0,s.jsx)("div",{className:"flex items-center gap-2",children:"".concat(e.nombres," ").concat(e.apellidos)})}),(0,s.jsx)(n.nA,{className:"hidden md:table-cell",children:null==(r=e.sexo)?void 0:r.nombre}),(0,s.jsx)(n.nA,{className:"hidden lg:table-cell",children:new Date(e.fecha_nacimiento).toLocaleDateString("es-ES")}),(0,s.jsx)(n.nA,{children:e.grade}),(0,s.jsx)(n.nA,{className:"hidden lg:table-cell",children:new Date(e.enrollmentDate).toLocaleDateString("es-ES")}),(0,s.jsx)(n.nA,{className:"hidden lg:table-cell",children:e.fecha_retiro?new Date(e.fecha_retiro).toLocaleDateString("es-ES"):"-"}),(0,s.jsx)(n.nA,{className:"text-right",children:(0,s.jsx)(t.$,{variant:"ghost",size:"sm",children:"Editar"})})]},e.id)}):(0,s.jsx)(n.Hj,{children:(0,s.jsx)(n.nA,{colSpan:10,className:"h-24 text-center",children:"No se encontraron estudiantes."})})})]})})]})}),(0,s.jsxs)(c.Cf,{className:"sm:max-w-2xl",children:[(0,s.jsxs)(c.c7,{children:[(0,s.jsx)(c.L3,{className:"font-headline",children:"Matricular Nuevo Estudiante"}),(0,s.jsx)(c.rr,{children:"Complete los detalles a continuaci\xf3n para registrar a un nuevo estudiante. Se generar\xe1 una foto de perfil por IA si no se carga una."})]}),(0,s.jsx)(R,{onStudentAdded:e=>{r(r=>[e,...r]),N(!1)},nextId:M+1,sexos:a,courses:h})]})]})}},3707:(e,r,a)=>{Promise.resolve().then(a.bind(a,560))}},e=>{e.O(0,[723,28,635,441,255,358],()=>e(e.s=3707)),_N_E=e.O()}]);