"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[121],{7121:(e,r,n)=>{n.r(r),n.d(r,{EnrollStudentForm:()=>N});var l=n(5155),a=n(2544),s=n(6942),i=n(5653),t=n(3998),o=n(3281),c=n(5142),d=n(788),u=n(8077),m=n(926);let x=(0,m.createServerReference)("4072d8b33c0328022b53ec6a098e4c52f0b26b6020",m.callServer,void 0,m.findSourceMapURL,"getRoleIdByName"),h=(0,m.createServerReference)("406470cb13a121586ae2d149509168abef4d87f656",m.callServer,void 0,m.findSourceMapURL,"getStaffByRut"),j=(0,m.createServerReference)("60bd0646e89e3f2167cc922d02e8c57fb1279cc1c9",m.callServer,void 0,m.findSourceMapURL,"createUser"),p=(0,m.createServerReference)("40ab7bcfb75dd71eedd7027941ba4a90f61f0ba607",m.callServer,void 0,m.findSourceMapURL,"addStudent");var f=n(5894),v=n(2115),g=n(2033),b=n(109),S=n(4269),z=n(1186);let _=i.z.object({id:i.z.string().min(1,"El n\xfamero de registro es requerido."),rut:i.z.string().refine(S.y,{message:"RUT inv\xe1lido."}),nombres:i.z.string().min(2,"El nombre debe tener al menos 2 caracteres."),apellidos:i.z.string().min(2,"Los apellidos deben tener al menos 2 caracteres."),sexo_id:i.z.string({required_error:"Debe seleccionar un sexo."}),fecha_nacimiento:i.z.string({required_error:"Debe seleccionar una fecha de nacimiento."}).refine(e=>!isNaN(new Date(e).getTime()),{message:"La fecha de nacimiento no es v\xe1lida."}),email:i.z.string().email("Email inv\xe1lido."),phone:i.z.string().min(5,"N\xfamero de tel\xe9fono inv\xe1lido.").optional().or(i.z.literal("")),address:i.z.string().min(5,"Direcci\xf3n inv\xe1lida.").optional().or(i.z.literal("")),curso_id:i.z.string({required_error:"Debe seleccionar un curso."}),enrollmentDate:i.z.string({required_error:"Debe seleccionar una fecha de matr\xedcula."}).refine(e=>!isNaN(new Date(e).getTime()),{message:"La fecha de matr\xedcula no es v\xe1lida."})});function N(e){let{onStudentAdded:r,nextId:n,sexos:i,courses:m}=e,{toast:N}=(0,f.dj)(),[R,C]=(0,v.useState)(!1),[D,y]=(0,v.useState)(!1),[M,w]=(0,v.useState)(i),[E,B]=(0,v.useState)(m),I=(0,v.useRef)(null),[T,J]=(0,v.useState)(null),[V,U]=(0,v.useState)(null),q=(0,a.mN)({resolver:(0,s.u)(_),defaultValues:{id:String(n),rut:"",nombres:"",apellidos:"",sexo_id:"",fecha_nacimiento:"",email:"",phone:"",address:"",curso_id:"",enrollmentDate:new Date().toISOString().split("T")[0]}});(0,v.useEffect)(()=>{var e;null==(e=I.current)||e.focus()},[]),(0,v.useEffect)(()=>{!async function(){i&&0!==i.length||w(await (0,d.T)()),m&&0!==m.length||B(await (0,u.N)()),U(await x("Estudiante"))}()},[i,m]);let Y=async()=>{let e=q.getValues("rut");if(!(0,S.y)(e))return void q.setError("rut",{type:"manual",message:"RUT inv\xe1lido."});y(!0);try{let r=await h(e);r?(J(r.id),q.setValue("nombres",r.nombres),q.setValue("apellidos",r.apellidos),q.setValue("email",r.email),q.setValue("phone",r.telefono||""),q.setValue("address",r.direccion||""),q.setValue("fecha_nacimiento",r.fecha_nacimiento?new Date(r.fecha_nacimiento).toISOString().split("T")[0]:""),r.sexo&&q.setValue("sexo_id",r.sexo.id),N({title:"Persona Encontrada",description:"Datos cargados en el formulario."})):(J(null),N({title:"No Encontrado",description:"No se encontr\xf3 a nadie con ese RUT. Puede registrarlo manualmente.",variant:"destructive"}))}catch(e){N({title:"Error en la B\xfasqueda",description:e.message||"No se pudo realizar la b\xfasqueda.",variant:"destructive"})}finally{y(!1)}};async function L(e){C(!0);try{var n;let l=T,a={...e,fecha_nacimiento:new Date(e.fecha_nacimiento).toISOString(),enrollmentDate:new Date(e.enrollmentDate).toISOString()};l||(l=await j({rut:a.rut,nombres:a.nombres,apellidos:a.apellidos,email:a.email,phone:a.phone,address:a.address,sexo_id:a.sexo_id,fecha_nacimiento:a.fecha_nacimiento},V));let s="".concat(e.nombres," ").concat(e.apellidos);await p({...a,usuario:l});let i={...e,id:e.id,sexo:M.find(r=>r.id===e.sexo_id)||null,grade:(null==(n=E.find(r=>r.id===e.curso_id))?void 0:n.nombre)||""};r(i),N({title:"Estudiante Matriculado",description:"".concat(s," ha sido a\xf1adido exitosamente.")}),q.reset()}catch(e){N({title:"Error",description:e.message||"Ocurri\xf3 un error al matricular al estudiante.",variant:"destructive"})}finally{C(!1)}}return(0,l.jsx)(o.lV,{...q,children:(0,l.jsxs)("form",{onSubmit:q.handleSubmit(L),className:"space-y-6",children:[(0,l.jsx)(o.zB,{control:q.control,name:"id",render:e=>{let{field:r}=e;return(0,l.jsxs)(o.eI,{children:[(0,l.jsx)(o.lR,{children:"N\xfamero de Registro"}),(0,l.jsx)(o.MJ,{children:(0,l.jsx)(c.p,{placeholder:"Ej: STU-001",...r,readOnly:!0})}),(0,l.jsx)(o.C5,{})]})}}),(0,l.jsxs)("div",{className:"flex items-end gap-2",children:[(0,l.jsx)(o.zB,{control:q.control,name:"rut",render:e=>{let{field:r}=e;return(0,l.jsxs)(o.eI,{className:"flex-grow",children:[(0,l.jsx)(o.lR,{children:"RUT"}),(0,l.jsx)(o.MJ,{children:(0,l.jsx)(c.p,{placeholder:"12.345.678-9",...r,ref:I,onBlur:e=>r.onChange((0,S.P)(e.target.value))})}),(0,l.jsx)(o.C5,{})]})}}),(0,l.jsxs)(t.$,{type:"button",onClick:Y,disabled:D,className:"h-10",children:[D?(0,l.jsx)(g.A,{className:"h-4 w-4 animate-spin"}):(0,l.jsx)(b.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sr-only",children:"Buscar"})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,l.jsx)(o.zB,{control:q.control,name:"nombres",render:e=>{let{field:r}=e;return(0,l.jsxs)(o.eI,{children:[(0,l.jsx)(o.lR,{children:"Nombre Completo"}),(0,l.jsx)(o.MJ,{children:(0,l.jsx)(c.p,{placeholder:"Ej: Juan P\xe9rez",...r})}),(0,l.jsx)(o.C5,{})]})}}),(0,l.jsx)(o.zB,{control:q.control,name:"apellidos",render:e=>{let{field:r}=e;return(0,l.jsxs)(o.eI,{children:[(0,l.jsx)(o.lR,{children:"Apellidos"}),(0,l.jsx)(o.MJ,{children:(0,l.jsx)(c.p,{placeholder:"Ej: P\xe9rez D\xedaz",...r})}),(0,l.jsx)(o.C5,{})]})}}),(0,l.jsx)(o.zB,{control:q.control,name:"enrollmentDate",render:e=>{let{field:r}=e;return(0,l.jsxs)(o.eI,{children:[(0,l.jsx)(o.lR,{children:"Fecha de Matr\xedcula"}),(0,l.jsx)(o.MJ,{children:(0,l.jsx)(c.p,{type:"date",placeholder:"YYYY-MM-DD",...r,value:r.value?r.value.split("T")[0]:""})}),(0,l.jsx)(o.C5,{})]})}}),(0,l.jsx)(o.zB,{control:q.control,name:"curso_id",render:e=>{let{field:r}=e;return(0,l.jsxs)(o.eI,{children:[(0,l.jsx)(o.lR,{children:"Curso"}),(0,l.jsxs)(z.l6,{onValueChange:r.onChange,value:r.value,children:[(0,l.jsx)(o.MJ,{children:(0,l.jsx)(z.bq,{children:(0,l.jsx)(z.yv,{placeholder:"Seleccione un curso"})})}),(0,l.jsx)(z.gC,{children:E.map(e=>(0,l.jsx)(z.eb,{value:e.id,children:e.nombre},e.id))})]}),(0,l.jsx)(o.C5,{})]})}}),(0,l.jsx)(o.zB,{control:q.control,name:"email",render:e=>{let{field:r}=e;return(0,l.jsxs)(o.eI,{children:[(0,l.jsx)(o.lR,{children:"Email"}),(0,l.jsx)(o.MJ,{children:(0,l.jsx)(c.p,{placeholder:"ejemplo@email.com",...r})}),(0,l.jsx)(o.C5,{})]})}}),(0,l.jsx)(o.zB,{control:q.control,name:"sexo_id",render:e=>{let{field:r}=e;return(0,l.jsxs)(o.eI,{children:[(0,l.jsx)(o.lR,{children:"Sexo"}),(0,l.jsxs)(z.l6,{onValueChange:r.onChange,value:r.value,children:[(0,l.jsx)(o.MJ,{children:(0,l.jsx)(z.bq,{children:(0,l.jsx)(z.yv,{placeholder:"Seleccione el sexo"})})}),(0,l.jsx)(z.gC,{children:M.map(e=>(0,l.jsx)(z.eb,{value:e.id,children:e.nombre},e.id))})]}),(0,l.jsx)(o.C5,{})]})}}),(0,l.jsx)(o.zB,{control:q.control,name:"fecha_nacimiento",render:e=>{let{field:r}=e;return(0,l.jsxs)(o.eI,{children:[(0,l.jsx)(o.lR,{children:"Fecha de Nacimiento"}),(0,l.jsx)(o.MJ,{children:(0,l.jsx)(c.p,{type:"date",placeholder:"YYYY-MM-DD",...r,value:r.value?r.value.split("T")[0]:""})}),(0,l.jsx)(o.C5,{})]})}}),(0,l.jsx)(o.zB,{control:q.control,name:"phone",render:e=>{let{field:r}=e;return(0,l.jsxs)(o.eI,{children:[(0,l.jsx)(o.lR,{children:"Tel\xe9fono"}),(0,l.jsx)(o.MJ,{children:(0,l.jsx)(c.p,{placeholder:"555-123-4567",...r})}),(0,l.jsx)(o.C5,{})]})}}),(0,l.jsx)(o.zB,{control:q.control,name:"address",render:e=>{let{field:r}=e;return(0,l.jsxs)(o.eI,{className:"sm:col-span-2",children:[(0,l.jsx)(o.lR,{children:"Direcci\xf3n"}),(0,l.jsx)(o.MJ,{children:(0,l.jsx)(c.p,{placeholder:"123 Calle Falsa, Ciudad",...r})}),(0,l.jsx)(o.C5,{})]})}})]}),(0,l.jsx)("div",{className:"flex justify-end",children:(0,l.jsxs)(t.$,{type:"submit",disabled:R,className:"w-full sm:w-auto",children:[R&&(0,l.jsx)(g.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Matricular Estudiante"]})})]})})}}}]);